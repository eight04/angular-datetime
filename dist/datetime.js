!function(e){"use strict";e.module("datetime",[]),e.module("datetime").constant("datetimePlaceholder",{year:"(year)",yearShort:"(year)",month:"(month)",date:"(date)",day:"(day)",hour:"(hour)",hour12:"(hour12)",minute:"(minute)",second:"(second)",millisecond:"(millisecond)",ampm:"(AM/PM)",week:"(week)"});var b=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},$=require("angular"),L=require("custom-input").TextParser,E=require("custom-input/lib/utils").num2str;function t(e,t){var m=e.DATETIME_FORMATS,c=/yyyy|yy|y|M{1,4}|dd?|EEEE?|HH?|hh?|mm?|ss?|([.,])sss|a|Z{1,2}|ww|w|'(([^']+|'')*)'/g,l={y:{minLength:1,maxLength:4,max:9999,min:0,name:"year",type:"number"},yy:{minLength:2,maxLength:2,name:"yearShort",type:"number"},yyyy:{minLength:4,maxLength:4,max:9999,min:0,name:"year",type:"number"},MMMM:{name:"month",type:"select",select:m.MONTH},MMM:{name:"month",type:"select",select:m.SHORTMONTH},MM:{minLength:2,maxLength:2,name:"month",type:"number"},M:{minLength:1,maxLength:2,name:"month",type:"number",min:1},dd:{minLength:2,maxLength:2,name:"date",type:"number"},d:{minLength:1,maxLength:2,name:"date",type:"number",min:1},EEEE:{name:"day",type:"select",select:v(m.DAY)},EEE:{name:"day",type:"select",select:v(m.SHORTDAY)},HH:{minLength:2,maxLength:2,name:"hour",type:"number"},H:{minLength:1,maxLength:2,name:"hour",type:"number"},hh:{minLength:2,maxLength:2,name:"hour12",type:"number"},h:{minLength:1,maxLength:2,name:"hour12",type:"number"},mm:{minLength:2,maxLength:2,name:"minute",type:"number"},m:{minLength:1,maxLength:2,name:"minute",type:"number"},ss:{minLength:2,maxLength:2,name:"second",type:"number"},s:{minLength:1,maxLength:2,name:"second",type:"number"},sss:{minLength:3,maxLength:3,name:"millisecond",type:"number"},a:{name:"ampm",type:"select",select:m.AMPMS},ww:{minLength:2,maxLength:2,max:53,name:"week",type:"number"},w:{minLength:1,maxLength:2,max:53,name:"week",type:"number"},Z:{name:"timezone",type:"static"},ZZ:{name:"timezone",type:"static",colon:!0},string:{name:"string",type:"static"}},n={year:{extract:function(e){var t=e.getFullYear()%1e4;return 0<=t?t:0},restore:function(e,t){return e.setFullYear(t)},add:function(e,t){return e.setFullYear(e.getFullYear()+t)},prior:7},yearShort:{extract:function(e){var t=e.getFullYear()%100;return 0<=t?t:t+100},restore:function(e,t){return e.setFullYear(t)},add:function(e,t){return e.setFullYear(e.getFullYear()+t)},prior:7},month:{extract:function(e){return e.getMonth()+1},restore:function(e,t){e.setMonth(t-1),e.getMonth()==t&&e.setDate(0)},add:function(e,t){t=e.getMonth()+t,e.setMonth(t),e.getMonth()==t+1&&e.setDate(0)},prior:5},date:{extract:function(e){return e.getDate()},restore:function(e,t,n){var r=e.getMonth();if(e.setDate(t),e.getMonth()!=r&&t<=31){var i=n.getNodes("month");i&&i.every(function(e){return e.empty})&&e.setDate(t)}},add:function(e,t,n){this.restore(e,e.getDate()+t,n)},prior:4},day:{extract:function(e){return e.getDay()||7},restore:function(e,t){var n=e.getMonth(),r=t-(e.getDay()||7);e.setDate(e.getDate()+r),e.getMonth()!=n&&(0<r?e.setDate(e.getDate()-7):e.setDate(e.getDate()+7))},add:function(e,t){return e.setDate(e.getDate()+t)},prior:4},hour:{extract:function(e){return e.getHours()},restore:function(e,t){return e.setHours(t)},add:function(e,t){return e.setHours(e.getHours()+t)},prior:2},hour12:{extract:function(e){return e.getHours()%12||12},restore:function(e,t){t%=12,12<=e.getHours()&&(t+=12);e.setHours(t)},add:function(e,t){return e.setHours(e.getHours()+t)},prior:2},ampm:{extract:function(e){return e.getHours()<12?1:2},restore:function(e,t){var n=e.getHours();n<12==1<t&&e.setHours((n+12)%24)},add:function(e,t){return e.setHours(e.getHours()+12*t)},prior:3},minute:{extract:function(e){return e.getMinutes()},restore:function(e,t){return e.setMinutes(t)},add:function(e,t){return e.setMinutes(e.getMinutes()+t)},prior:0},second:{extract:function(e){return e.getSeconds()},restore:function(e,t){return e.setSeconds(t)},add:function(e,t){return e.setSeconds(e.getSeconds()+t)},prior:1},millisecond:{extract:function(e){return e.getMilliseconds()},restore:function(e,t){return e.setMilliseconds(t)},add:function(e,t){return e.setMilliseconds(e.getMilliseconds()+t)},prior:1},week:{extract:x,restore:function(e,t){return e.setDate(e.getDate()+7*(t-x(e)))},add:function(e,t){return e.setDate(e.getDate()+7*t)},prior:6}};for(var r in n)n[r].placeholder=t[r];var i=Object.values(l),a=Array.isArray(i),o=0;for(i=a?i:i[Symbol.iterator]();;){var s;if(a){if(o>=i.length)break;s=i[o++]}else{if((o=i.next()).done)break;s=o.value}var u=s;n[u.name]&&$.extend(u,n[u.name])}var d,g,h,f,p,y=(d=-(new Date).getTimezoneOffset(),g=0<=d?"+":"-",h=Math.abs(d),f=Math.floor(h/60),p=h%60,g+E(f,2,2)+E(p,2,2));function v(e){var t,n=[];for(t=1;t<e.length;t++)n.push(e[t]);return n.push(e[0]),n}function x(e){var t=new Date(e.getFullYear(),0,1),n=new Date(t.getTime());4<n.getDay()?n.setDate(n.getDate()+(1-n.getDay())+7):n.setDate(n.getDate()+(1-n.getDay()));var r=e.getTime()-n.getTime();return Math.floor(r/6048e5)}function D(e){return":"==e[3]?e:e.substr(0,3)+":"+e.substr(3,2)}function T(e){return":"!=e[3]?e:e.substr(0,3)+e.substr(4,2)}var M=function(){function t(e){b(this,t),this.tp=e,this.timezone=y,this.timezoneNodes=this.tp.nodes.filter(function(e){return"timezone"==e.token.name})}return t.prototype.parse=function(e){return this.tp.parse(e),this},t.prototype.getText=function(){return this.tp.getText()},t.prototype.setDate=function(e,t){var n,r,i;return this.tp.setValue((n=e,r=this.timezone,i=(60*+(r=T(r)).substr(1,2)+ +r.substr(3,2))*(r[0]+"1"),new Date(n.getTime()+60*(i- -n.getTimezoneOffset())*1e3)),t),this},t.prototype.getDate=function(){return e=this.tp.getValue(),t=this.timezone,n=(60*+(t=T(t)).substr(1,2)+ +t.substr(3,2))*(t[0]+"1"),new Date(e.getTime()+60*(-e.getTimezoneOffset()-n)*1e3);var e,t,n},t.prototype.setTimezone=function(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:y;if(e!=this.timezone){var t=this.getDate();this.timezone=e;var n=this.timezoneNodes,r=Array.isArray(n),i=0;for(n=r?n:n[Symbol.iterator]();;){var a;if(r){if(i>=n.length)break;a=n[i++]}else{if((i=n.next()).done)break;a=i.value}var o=a;o.token.colon?o.token.value=D(e):o.token.value=T(e)}return this.setDate(t,!1)}},t.prototype.isEmpty=function(){return this.tp.isEmpty.apply(this.tp,arguments)},t.prototype.isInit=function(){return this.tp.isInit.apply(this.tp,arguments)},t.prototype.unset=function(){return this.tp.unset(),this},t}();return function(e){var t,n=function(e){for(var t,n=[],r=0;t=c.exec(e);)if(t.index>r&&(n.push($.extend({value:e.substring(r,t.index)},l.string)),r=t.index),t.index==r){if(t[1])n.push($.extend({value:t[1]},l.string)),n.push(l.sss);else if(t[2])n.push($.extend({value:t[2].replace("''","'")},l.string));else if("timezone"==l[t[0]].name){var i=y;l[t[0]].colon&&(i=D(i)),n.push($.extend({value:i},l[t[0]]))}else n.push(l[t[0]]);r=c.lastIndex}return r<e.length&&n.push($.extend({value:e.substring(r)},l.string)),n}(m[e]||e);t=n.some(function(e){return"yearShort"==e.name})?function(n){return function(e){n.apply(this,arguments);var t=e.getFullYear();t<0&&e.setFullYear(t+100)}}:function(n){return function(e){n.apply(this,arguments);var t=e.getFullYear();t<0&&e.setFullYear(0),9999<t&&e.setFullYear(9999)}};var r=n,i=Array.isArray(r),a=0;for(r=i?r:r[Symbol.iterator]();;){var o;if(i){if(a>=r.length)break;o=r[a++]}else{if((a=r.next()).done)break;o=a.value}var s=o;s.add&&(s.add=t(s.add)),s.restore&&(s.restore=t(s.restore))}var u=new L({tokens:n,value:new Date,copyValue:function(e){return new Date(e.getTime())}});return new M(u)}}$.module("datetime").factory("datetime",t),t.$inject=["$locale","datetimePlaceholder"];var y=require("angular"),v=require("custom-input").InputMask;function n(h,e,f){var p=function(){function n(e,t){b(this,n),this.el=e,this.doc=t}return n.prototype.on=function(e,t){if("input"!=e)return this.el.on(e,t)},n.prototype.getSelection=function(){var e=this.el[0];if(this.doc.activeElement==e){var t=e.selectionStart,n=e.selectionEnd;return y.isDefined(t)&&y.isDefined(n)?{start:t,end:n}:this.getSelectionIE()}},n.prototype.getSelectionIE=function(){var e=this.el[0],t=this.doc.selection.createRange().getBookmark(),n=e.createTextRange(),r=n.duplicate();n.moveToBookmark(t),r.setEndPoint("EndToStart",n);var i=r.text.length;return{start:i,end:i+n.text.length}},n.prototype.setSelection=function(e,t){var n=this.el[0];this.doc.activeElement==n&&(n.setSelectionRange?n.setSelectionRange(e,t):this.setSelectionIE(e,t))},n.prototype.setSelectionIE=function(e,t){var n=this.el[0].createTextRange();n.moveStart("character",e),n.collapse(),n.moveEnd("character",t-e),n.select()},n.prototype.val=function(){var e;return(e=this.el).val.apply(e,arguments)},n}();return{restrict:"A",require:"?ngModel",link:function(n,e,t,r){if(!r)return!1;t.ngTrim="false";var i,a=h(t.datetime),o=t.datetimeModel&&h(t.datetimeModel),s=new p(e,f[0]),u=new v(s,a.tp,t.datetimeSeparator);function m(e){e&&!i?(i=!0,a.setTimezone("+0000"),o&&o.setTimezone("+0000")):!e&&i&&(i=!1,a.setTimezone(),o&&o.setTimezone())}function c(e){a.setTimezone(e),o&&o.setTimezone(e)}function l(e){return!(!r.$isEmpty(e)&&!r.$isEmpty(t.min))||(y.isDate(e)||(e=o.getDate()),e>=new Date(t.min))}function d(e){return!(!r.$isEmpty(e)&&!r.$isEmpty(t.max))||(y.isDate(e)||(e=o.getDate()),e<=new Date(t.max))}function g(e){return r.$validate?r.$validate():(r.$setValidity("min",l(e)),r.$setValidity("max",d(e))),!r.$error.min&&!r.$error.max}u.on("digest",function(e){"NOT_INIT"!=e.code&&r.$setValidity("datetime",!1)}),a.tp.on("change",function(){n.$evalAsync(function(){u.err?r.$setValidity("datetime",!1):(a.isInit()||a.isEmpty()?r.$setValidity("datetime",!0):r.$setValidity("datetime",!1),a.getText()!=r.$viewValue&&r.$setViewValue(a.getText()))})}),y.isDefined(t.datetimeUtc)&&(0<t.datetimeUtc.length?n.$watch(t.datetimeUtc,m):m(!0)),y.isDefined(t.datetimeTimezone)&&(/^[+-]\d{2}:?\d{2}$/.test(t.datetimeTimezone)?c(t.datetimeTimezone):n.$watch(t.datetimeTimezone,c)),r.$validators&&(r.$validators.min=l,r.$validators.max=d),t.$observe("min",function(){g(a.getDate())}),t.$observe("max",function(){g(a.getDate())}),r.$render=function(){},r.$isEmpty=function(e){return!e||"string"==typeof e&&a.isEmpty(e)},r.$parsers.unshift(function(e){if(y.isUndefined(e)&&(e=a.getText()),!y.isString(e))return e;if(u.digest(null,e),!a.isInit())return undefined;var t=a.getDate();return r.$validate||g(t)?o?o.setDate(t).getText():new Date(t.getTime()):undefined}),r.$formatters.push(function(e){return r.$setValidity("datetime",!0),e?(t=e,y.isDate(t)&&!o||y.isString(t)&&o?(o&&(e=o.parse(e).getDate()),r.$validate||g(e),a.setDate(e).getText()):e):(a.unset(),n.$evalAsync(function(){r.$setViewValue(a.getText())}),a.getText());var t})},priority:100}}y.module("datetime").directive("datetime",n),n.$inject=["datetime","$log","$document"]}(angular);
